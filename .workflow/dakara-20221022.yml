version: '1.0'
name: dakara-20221022
displayName: dakara
triggers:
  trigger: manual
  push:
    branches:
      prefix:
        - ''
  schedule:
    - cron: '0 11,42 7,8 * * ? *'
variables:
  global:
    - MY_SECRET_USERNAME
    - MY_SECRET_PASSWORD
stages:
  - name: dakara-c1b3ba0c
    displayName: dakara
    strategy: naturally
    trigger: auto
    executor: []
    steps:
      - step: build@python
        name: build_python
        displayName: Step
        pythonVersion: '3.7'
        commands:
          - pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
          - pip install httpx selenium
          # Disable epel repo to reduce time consumption(~4-8min)
          - sed -e 's|^enabled=1|enabled=0|g' -i.bak /etc/yum.repos.d/epel*.repo
          - yum -y install firefox
          # - wget https://github.com/mozilla/geckodriver/releases/download/v0.32.0/geckodriver-v0.32.0-linux64.tar.gz
          # - tar -xvzf geckodriver*
          - cp ./assets/geckodriver ./
          - chmod +x geckodriver
          - export PATH=$PATH:$(pwd)
          - export DAKA_RUNNER=Gitee
          - export MY_SECRET_USERNAME=$MY_SECRET_USERNAME
          - export MY_SECRET_PASSWORD=$MY_SECRET_PASSWORD
          # - python ./src/delay.py
          - python ./fork/daka.py
        artifacts:
          - name: BUILD_ARTIFACT
            path:
              - ./
        caches: []
        notify: []
        strategy:
          retry: '0'
